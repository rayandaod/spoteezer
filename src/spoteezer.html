<!DOCTYPE html>
<html>

<head>
    <title>Spoteezer</title><link rel="icon" type="image/png" href="../assets/spoteezer.png">
    <link rel='stylesheet' type='text/css' href='style.css'>
</head>

<body>
    <div id="head">
        <h1>Spoteezer</h1>
        <img src="../assets/spoteezer.png" alt="Spoteezer logo" id="spoteezer-logo">
    </div>
    
    <div id="center-elems">
        <input id="deezer-link" placeholder="Deezer link (track, album, or artist)">
        <button id="convert-button">Convert to Spotify</button>
    </div>
    
    <div id="results">
        <a id="cover-link" href="">
            <img id="cover-img" src="" alt="Cover">
        </a>
        <a id="info"></a>
        <a id="more-info"></a>
        <a id="result-link" href=""></a>
        <div id="logs"></div>
    </div>
    

    <a href="https://github.com/rayandaod/spoteezer">
        <img src="../assets/github_logo.png" alt="GitHub logo" id="github-logo">
    </a>

    <script>
        const form = document.getElementById('center-elems');
        const deezerLinkInput = document.getElementById('deezer-link');
        const buttonElement = document.getElementById('convert-button');

        const imgElement = document.getElementById('cover-img');
        const imgLinkElement = document.getElementById('cover-link');

        const infoElement = document.getElementById('info');
        const moreInfoElement = document.getElementById('more-info');
        const resultLinkElement = document.getElementById('result-link');
        const logElement = document.getElementById('logs');

        // Add an event listener to the form to handle the submission
        buttonElement.addEventListener('click', (event) => {
            event.preventDefault();

            // Get the Deezer link from the input
            const deezerLink = deezerLinkInput.value;

            // Clear the result and log elements
            imgElement.style.display = 'none'
            imgLinkElement.href = '';
            imgElement.src = '';
            infoElement.innerHTML = '';
            moreInfoElement.innerHTML = '';
            resultLinkElement.href = '';
            resultLinkElement.innerHTML = '';
            logElement.innerHTML = '';

            // Send a GET request to the server with the Deezer link
            fetch('https://rayandaod.pythonanywhere.com/convert', {
            // fetch('http://127.0.0.1:8080/convert', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ deezerLink: deezerLink }),
            })
                .then((response) => {
                    // When the server responds, parse the response as JSON
                    return response.json();
                })
                .then((data) => {
                    // Get the Spotify link and log messages from the response data
                    const spotifyLink = data.result.spotify_link;
                    const img_src = data.result.img_src;
                    const type = data.result.type;
                    const info = data.result.info[type];
                    delete data.result.info[type]
                    const more_info = data.result.info;
                    const log = data.log;

                    // Set the image element to the img src and make it clickable
                    if (img_src != '') {
                        imgElement.style.display = 'block';
                        imgElement.src = img_src;
                        imgLinkElement.href = spotifyLink;
                    }

                    // Set the info element to the info
                    infoElement.innerHTML = info;
                    moreInfoElement.innerHTML = JSON.stringify(more_info);

                    // Set the result link element to the Spotify link and make it clickable
                    resultLinkElement.innerHTML = spotifyLink;
                    resultLinkElement.href = spotifyLink;
                    resultLinkElement.target = '_blank';

                    // Set the log element to the log messages
                    logElement.innerHTML = log;
                })
                .catch((error) => {
                    // If there is an error, log it to the console and set the log element to the error message
                    console.error(error);
                    logElement.innerHTML = 'An error occurred: ' + error + ' Try again.';
                });
        });

    </script>
</body>

</html>